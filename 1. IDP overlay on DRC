# 2. IDP_Overlay DRC
# Load the ACLED dataset using read.csv
acled <- read.csv("Documents/2024 Peloria/1. X Conflict Data/Africa_1997-2024_Nov08.csv", header = TRUE)

# Preview the data
head(acled)

# Install remotes if not already installed
if (!requireNamespace("remotes", quietly = TRUE)) {
  install.packages("remotes")
}

# Install rnaturalearthhires from GitHub
remotes::install_github("ropensci/rnaturalearthhires")

install.packages(c("lubridate", "rnaturalearthhires", "rnaturalearth", "rnaturalearthdata", 
                   "dplyr", "janitor", "stringdist", "shiny", "leaflet", "leaflet.extras", 
                   "fuzzyjoin", "sf", "ggplot2", "forecast"))

required_packages <- c(
  "lubridate", "rnaturalearth", "rnaturalearthdata", 
  "dplyr", "janitor", "stringdist", "shiny", 
  "leaflet", "leaflet.extras", "fuzzyjoin", 
  "sf", "ggplot2", "forecast"
)

# Install missing packages
install.packages(setdiff(required_packages, installed.packages()[, "Package"]))

# Load the libraries
lapply(required_packages, library, character.only = TRUE)

install.packages("dtmapi")
library(dtmapi)

library(lubridate)
library(rnaturalearthhires)
library(rnaturalearth)
library(rnaturalearthdata)
library(dplyr)
library(janitor)
library(stringdist)
library(shiny)
library(leaflet)
library(leaflet.extras)
library(fuzzyjoin)
library(sf)
library(ggplot2)
library(forecast)

admin1 <- ne_states(country = "Democratic Republic of the Congo", returnclass = "sf")


# Get IDP Admin 1 Data for the Democratic Republic of the Congo (DRC) for all reporting dates
idp_admin1_df <- get_idp_admin1_data(CountryName = 'Democratic Republic of the Congo')

# Display the first few rows of the data frame
head(idp_admin1_df)

####################
library(leaflet)
library(dplyr)

# Create a color palette for IDPs
idp_palette <- colorNumeric(
  palette = c("lightpink", "darkred"), 
  domain = admin1_with_idp$total_idps, 
  na.color = "transparent"
)

# Overlay IDP data on the map
leaflet(admin1_with_idp) %>%
  addTiles() %>%
  addPolygons(
    fillColor = ~idp_palette(total_idps),
    weight = 1, opacity = 1, color = "white",
    fillOpacity = 0.7,
    label = ~paste0("Admin1: ", name, "<br>Total IDPs: ", total_idps)
  ) %>%
  addLegend(
    pal = idp_palette,
    values = ~total_idps,
    title = "Total IDPs",
    position = "bottomright"
  )
